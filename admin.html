<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Metadata for character set and viewport -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Page - The Habitat</title>

    <!-- Bootstrap CSS (latest version) -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/css/bootstrap.min.css"
    />

    <!-- Custom styles -->
    <style>
      body {
        font-family: "Montserrat", sans-serif;
        background-color: #f8f9fa;
        margin: 0;
        padding: 0;
      }

      .container {
        max-width: 800px;
        margin: 50px auto;
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }

      h2 {
        color: #343a40;
      }

      table {
        width: 100%;
        margin-top: 20px;
        border-collapse: collapse;
      }

      th,
      td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #dee2e6;
      }

      th {
        background-color: #007bff;
        color: #fff;
      }

      tr:hover {
        background-color: #f5f5f5;
      }

      .btn {
        padding: 6px 12px;
        margin-bottom: 0;
        font-size: 14px;
        font-weight: 400;
        line-height: 1.42857143;
        text-align: center;
        white-space: nowrap;
        vertical-align: middle;
        cursor: pointer;
        user-select: none;
        border: 1px solid transparent;
        border-radius: 4px;
      }

      .btn-danger {
        color: #fff;
        background-color: #dc3545;
        border-color: #dc3545;
      }
    </style>
  </head>

  <body>
    <!-- Main container -->
    <div class="container mt-5">
      <h2>Reservation Management</h2>

      <!-- Reservation table -->
      <table class="table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Date</th>
            <th>Time</th>
            <th>Package</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="reservationTableBody">
          <!-- Reservation data will be rendered here dynamically -->
        </tbody>
      </table>

      <!-- Home link -->
      <a href="./"><h3>me here baby</h3></a>
    </div>

    <!-- Firebase scripts -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import {
        getDatabase,
        ref,
        onValue,
        remove,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyB-6hbV69tC2QLhJhyy98KM0y2QCsRu-IU",
        authDomain: "logform-d296a.firebaseapp.com",
        databaseURL: "https://logform-d296a-default-rtdb.firebaseio.com",
        projectId: "logform-d296a",
        storageBucket: "logform-d296a.appspot.com",
        messagingSenderId: "455249423966",
        appId: "1:455249423966:web:b67034b8c55430f1e1cecf",
        measurementId: "G-6H8TCVCS1B",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);
      const reservationsRef = ref(database, "LOGFORM/reservations");

      // Function to render reservations in the table
      function renderReservations(reservations) {
        const reservationTableBody = document.getElementById(
          "reservationTableBody"
        );
        reservationTableBody.innerHTML = "";

        for (const key in reservations) {
          const reservation = reservations[key];
          const row = document.createElement("tr");

          // Cells for reservation data
          const cells = ["name", "email", "date", "time", "pack"];
          cells.forEach((cell) => {
            const cellElement = document.createElement("td");
            cellElement.textContent = reservation[cell];
            row.appendChild(cellElement);
          });

          // Delete button cell
          const deleteCell = document.createElement("td");
          const deleteButton = document.createElement("button");
          deleteButton.textContent = "Delete";
          deleteButton.classList.add("btn", "btn-danger");
          deleteButton.addEventListener("click", () => {
            deleteReservation(key);
          });
          deleteCell.appendChild(deleteButton);
          row.appendChild(deleteCell);

          reservationTableBody.appendChild(row);
        }
      }

      // Firebase event listener for changes in reservations
      onValue(reservationsRef, (snapshot) => {
        const reservations = snapshot.val();
        renderReservations(reservations);
      });

      // Function to delete a reservation
      function deleteReservation(key) {
        remove(ref(database, `LOGFORM/reservations/${key}`));
      }

      // Additional code for sorting by date
      document.getElementById("sortDate").addEventListener("click", () => {
        sortReservationsByDate();
      });

      // Function to sort reservations by date
      function sortReservationsByDate() {
        const reservationTableBody = document.getElementById(
          "reservationTableBody"
        );
        const rows = Array.from(reservationTableBody.children);
        const sortedRows = rows.sort((a, b) => {
          const dateA = new Date(a.cells[2].textContent);
          const dateB = new Date(b.cells[2].textContent);
          return dateA - dateB;
        });

        // Append sorted rows to the table body
        reservationTableBody.innerHTML = "";
        sortedRows.forEach((row) => {
          reservationTableBody.appendChild(row);
        });
      }
    </script>

    <!-- Bootstrap JS and jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.4.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/js/bootstrap.min.js"
      integrity="sha384-oCEmOeC+hVtWWpgezih8FgNpfsAd1mr9ujJn5tl4Gg0P4eqFMa8/OnQmZ6vO3l+3"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
